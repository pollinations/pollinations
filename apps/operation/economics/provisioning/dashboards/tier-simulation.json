{
  "annotations": {
    "list": [{
      "builtIn": 1,
      "datasource": {
        "type": "grafana",
        "uid": "-- Grafana --"
      },
      "enable": true,
      "hide": true,
      "iconColor": "rgba(0, 211, 255, 1)",
      "name": "Annotations & Alerts",
      "type": "dashboard"
    }]
  },
  "description": "Simulate tier cost changes â€” adjust daily allowances per tier and see projected savings based on real historical usage data",
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 1,
  "id": null,
  "links": [],
  "panels": [
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 },
      "id": 100,
      "panels": [],
      "title": "Summary",
      "type": "row"
    },
    {
      "datasource": {
        "type": "grafana-clickhouse-datasource",
        "uid": "PAD1A0A25CD30D456"
      },
      "description": "Total actual tier-subsidized cost in the selected time range.",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "red", "value": null }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": []
      },
      "gridPos": { "h": 5, "w": 6, "x": 0, "y": 1 },
      "id": 1,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": ["sum"],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "pluginVersion": "12.4.0",
      "targets": [{
        "datasource": {
          "type": "grafana-clickhouse-datasource",
          "uid": "PAD1A0A25CD30D456"
        },
        "format": 0,
        "range": true,
        "rawSql": "SELECT\n  toStartOfInterval(start_time, INTERVAL 1 DAY) as time,\n  SUM(total_price) as actual_cost\nFROM generation_event\nWHERE start_time >= $__fromTime AND start_time < $__toTime\n  AND selected_meter_slug = 'v1:meter:tier'\n  AND is_billed_usage = true\n  AND response_status >= 200 AND response_status < 300\n  AND user_tier IN ('microbe', 'spore', 'seed', 'flower', 'nectar')\nGROUP BY time\nORDER BY time",
        "refId": "A"
      }],
      "title": "Actual Tier Cost",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "grafana-clickhouse-datasource",
        "uid": "PAD1A0A25CD30D456"
      },
      "description": "Simulated tier cost if daily allowances were set to the values above. Per-user per-day spend is capped at the simulated allowance.",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "green", "value": null }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": []
      },
      "gridPos": { "h": 5, "w": 6, "x": 6, "y": 1 },
      "id": 2,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": ["sum"],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "pluginVersion": "12.4.0",
      "targets": [{
        "datasource": {
          "type": "grafana-clickhouse-datasource",
          "uid": "PAD1A0A25CD30D456"
        },
        "format": 0,
        "range": true,
        "rawSql": "WITH user_day AS (\n  SELECT\n    toDate(start_time) AS day,\n    user_github_username AS user,\n    user_tier AS tier,\n    SUM(total_price) AS actual_spend\n  FROM generation_event\n  WHERE start_time >= $__fromTime AND start_time < $__toTime\n    AND selected_meter_slug = 'v1:meter:tier'\n    AND is_billed_usage = true\n    AND response_status >= 200 AND response_status < 300\n    AND user_tier IN ('microbe', 'spore', 'seed', 'flower', 'nectar')\n  GROUP BY day, user, tier\n)\nSELECT\n  day AS time,\n  SUM(LEAST(actual_spend,\n    CASE tier\n      WHEN 'microbe' THEN ${sim_microbe}\n      WHEN 'spore'   THEN ${sim_spore}\n      WHEN 'seed'    THEN ${sim_seed}\n      WHEN 'flower'  THEN ${sim_flower}\n      WHEN 'nectar'  THEN ${sim_nectar}\n      ELSE 0\n    END\n  )) AS simulated_cost\nFROM user_day\nGROUP BY day\nORDER BY day",
        "refId": "A"
      }],
      "title": "Simulated Tier Cost",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "grafana-clickhouse-datasource",
        "uid": "PAD1A0A25CD30D456"
      },
      "description": "Total savings: actual cost minus simulated cost. Positive value = money saved by lowering tier allowances.",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "green", "value": null },
              { "color": "yellow", "value": 0 },
              { "color": "green", "value": 1 }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": []
      },
      "gridPos": { "h": 5, "w": 6, "x": 12, "y": 1 },
      "id": 3,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "pluginVersion": "12.4.0",
      "targets": [{
        "datasource": {
          "type": "grafana-clickhouse-datasource",
          "uid": "PAD1A0A25CD30D456"
        },
        "format": 1,
        "range": true,
        "rawSql": "WITH user_day AS (\n  SELECT\n    toDate(start_time) AS day,\n    user_github_username AS user,\n    user_tier AS tier,\n    SUM(total_price) AS actual_spend\n  FROM generation_event\n  WHERE start_time >= $__fromTime AND start_time < $__toTime\n    AND selected_meter_slug = 'v1:meter:tier'\n    AND is_billed_usage = true\n    AND response_status >= 200 AND response_status < 300\n    AND user_tier IN ('microbe', 'spore', 'seed', 'flower', 'nectar')\n  GROUP BY day, user, tier\n)\nSELECT\n  round(SUM(actual_spend) - SUM(LEAST(actual_spend,\n    CASE tier\n      WHEN 'microbe' THEN ${sim_microbe}\n      WHEN 'spore'   THEN ${sim_spore}\n      WHEN 'seed'    THEN ${sim_seed}\n      WHEN 'flower'  THEN ${sim_flower}\n      WHEN 'nectar'  THEN ${sim_nectar}\n      ELSE 0\n    END\n  )), 2) AS savings\nFROM user_day",
        "refId": "A"
      }],
      "title": "Total Savings",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "grafana-clickhouse-datasource",
        "uid": "PAD1A0A25CD30D456"
      },
      "description": "Percentage of tier cost that would be saved with the simulated allowances.",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "green", "value": null }
            ]
          },
          "unit": "percent"
        },
        "overrides": []
      },
      "gridPos": { "h": 5, "w": 6, "x": 18, "y": 1 },
      "id": 4,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "pluginVersion": "12.4.0",
      "targets": [{
        "datasource": {
          "type": "grafana-clickhouse-datasource",
          "uid": "PAD1A0A25CD30D456"
        },
        "format": 1,
        "range": true,
        "rawSql": "WITH user_day AS (\n  SELECT\n    toDate(start_time) AS day,\n    user_github_username AS user,\n    user_tier AS tier,\n    SUM(total_price) AS actual_spend\n  FROM generation_event\n  WHERE start_time >= $__fromTime AND start_time < $__toTime\n    AND selected_meter_slug = 'v1:meter:tier'\n    AND is_billed_usage = true\n    AND response_status >= 200 AND response_status < 300\n    AND user_tier IN ('microbe', 'spore', 'seed', 'flower', 'nectar')\n  GROUP BY day, user, tier\n)\nSELECT\n  round(\n    (SUM(actual_spend) - SUM(LEAST(actual_spend,\n      CASE tier\n        WHEN 'microbe' THEN ${sim_microbe}\n        WHEN 'spore'   THEN ${sim_spore}\n        WHEN 'seed'    THEN ${sim_seed}\n        WHEN 'flower'  THEN ${sim_flower}\n        WHEN 'nectar'  THEN ${sim_nectar}\n        ELSE 0\n      END\n    ))) * 100.0 / NULLIF(SUM(actual_spend), 0),\n    1\n  ) AS savings_pct\nFROM user_day",
        "refId": "A"
      }],
      "title": "Savings %",
      "type": "stat"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 6 },
      "id": 200,
      "panels": [],
      "title": "Per-Tier Comparison",
      "type": "row"
    },
    {
      "datasource": {
        "type": "grafana-clickhouse-datasource",
        "uid": "PAD1A0A25CD30D456"
      },
      "description": "Breakdown per tier: actual vs simulated cost, savings, and how many user-day instances would be capped. Users_Capped counts user-day pairs where actual spend exceeded the simulated cap.",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "custom": {
            "align": "auto",
            "cellOptions": { "type": "auto" },
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [{ "color": "green", "value": null }]
          }
        },
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "Tier" },
            "properties": [{ "id": "custom.width", "value": 80 }]
          },
          {
            "matcher": { "id": "byName", "options": "Current_Allowance" },
            "properties": [
              { "id": "unit", "value": "currencyUSD" },
              { "id": "decimals", "value": 2 },
              { "id": "custom.width", "value": 100 }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "Simulated_Allowance" },
            "properties": [
              { "id": "unit", "value": "currencyUSD" },
              { "id": "decimals", "value": 2 },
              { "id": "custom.width", "value": 110 }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "Actual_Cost" },
            "properties": [
              { "id": "unit", "value": "currencyUSD" },
              { "id": "decimals", "value": 2 }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "Simulated_Cost" },
            "properties": [
              { "id": "unit", "value": "currencyUSD" },
              { "id": "decimals", "value": 2 }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "Savings" },
            "properties": [
              { "id": "unit", "value": "currencyUSD" },
              { "id": "decimals", "value": 2 }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "Savings_Pct" },
            "properties": [
              { "id": "unit", "value": "percent" },
              { "id": "decimals", "value": 1 }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "Users_Capped" },
            "properties": [
              { "id": "unit", "value": "short" }
            ]
          }
        ]
      },
      "gridPos": { "h": 10, "w": 24, "x": 0, "y": 7 },
      "id": 5,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "enablePagination": false,
          "fields": "",
          "reducer": ["sum"],
          "show": true
        },
        "showHeader": true,
        "sortBy": [{
          "desc": true,
          "displayName": "Savings"
        }]
      },
      "pluginVersion": "12.4.0",
      "targets": [{
        "datasource": {
          "type": "grafana-clickhouse-datasource",
          "uid": "PAD1A0A25CD30D456"
        },
        "format": 1,
        "range": true,
        "rawSql": "WITH user_day AS (\n  SELECT\n    toDate(start_time) AS day,\n    user_github_username AS user,\n    user_tier AS tier,\n    SUM(total_price) AS actual_spend\n  FROM generation_event\n  WHERE start_time >= $__fromTime AND start_time < $__toTime\n    AND selected_meter_slug = 'v1:meter:tier'\n    AND is_billed_usage = true\n    AND response_status >= 200 AND response_status < 300\n    AND user_tier IN ('microbe', 'spore', 'seed', 'flower', 'nectar')\n  GROUP BY day, user, tier\n)\nSELECT\n  tier AS Tier,\n  CASE tier\n    WHEN 'microbe' THEN 0.1\n    WHEN 'spore'   THEN 1\n    WHEN 'seed'    THEN 3\n    WHEN 'flower'  THEN 10\n    WHEN 'nectar'  THEN 20\n    ELSE 0\n  END AS Current_Allowance,\n  CASE tier\n    WHEN 'microbe' THEN ${sim_microbe}\n    WHEN 'spore'   THEN ${sim_spore}\n    WHEN 'seed'    THEN ${sim_seed}\n    WHEN 'flower'  THEN ${sim_flower}\n    WHEN 'nectar'  THEN ${sim_nectar}\n    ELSE 0\n  END AS Simulated_Allowance,\n  round(SUM(actual_spend), 2) AS Actual_Cost,\n  round(SUM(LEAST(actual_spend,\n    CASE tier\n      WHEN 'microbe' THEN ${sim_microbe}\n      WHEN 'spore'   THEN ${sim_spore}\n      WHEN 'seed'    THEN ${sim_seed}\n      WHEN 'flower'  THEN ${sim_flower}\n      WHEN 'nectar'  THEN ${sim_nectar}\n      ELSE 0\n    END\n  )), 2) AS Simulated_Cost,\n  round(SUM(actual_spend) - SUM(LEAST(actual_spend,\n    CASE tier\n      WHEN 'microbe' THEN ${sim_microbe}\n      WHEN 'spore'   THEN ${sim_spore}\n      WHEN 'seed'    THEN ${sim_seed}\n      WHEN 'flower'  THEN ${sim_flower}\n      WHEN 'nectar'  THEN ${sim_nectar}\n      ELSE 0\n    END\n  )), 2) AS Savings,\n  round(\n    (SUM(actual_spend) - SUM(LEAST(actual_spend,\n      CASE tier\n        WHEN 'microbe' THEN ${sim_microbe}\n        WHEN 'spore'   THEN ${sim_spore}\n        WHEN 'seed'    THEN ${sim_seed}\n        WHEN 'flower'  THEN ${sim_flower}\n        WHEN 'nectar'  THEN ${sim_nectar}\n        ELSE 0\n      END\n    ))) * 100.0 / NULLIF(SUM(actual_spend), 0),\n    1\n  ) AS Savings_Pct,\n  countIf(actual_spend > CASE tier\n    WHEN 'microbe' THEN ${sim_microbe}\n    WHEN 'spore'   THEN ${sim_spore}\n    WHEN 'seed'    THEN ${sim_seed}\n    WHEN 'flower'  THEN ${sim_flower}\n    WHEN 'nectar'  THEN ${sim_nectar}\n    ELSE 0\n  END) AS Users_Capped\nFROM user_day\nGROUP BY tier\nORDER BY\n  CASE tier\n    WHEN 'nectar'  THEN 1\n    WHEN 'flower'  THEN 2\n    WHEN 'seed'    THEN 3\n    WHEN 'spore'   THEN 4\n    WHEN 'microbe' THEN 5\n    ELSE 6\n  END",
        "refId": "A"
      }],
      "title": "Per-Tier Comparison",
      "type": "table"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 17 },
      "id": 300,
      "panels": [],
      "title": "Daily Cost Comparison",
      "type": "row"
    },
    {
      "datasource": {
        "type": "grafana-clickhouse-datasource",
        "uid": "PAD1A0A25CD30D456"
      },
      "description": "Daily tier cost: actual (red) vs simulated (green). The gap between the lines is the daily savings from lowering tier allowances.",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "Daily Cost ($)",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 10,
            "gradientMode": "opacity",
            "hideFrom": { "legend": false, "tooltip": false, "viz": false },
            "insertNulls": false,
            "lineInterpolation": "smooth",
            "lineWidth": 2,
            "pointSize": 5,
            "scaleDistribution": { "type": "linear" },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": { "group": "A", "mode": "none" },
            "thresholdsStyle": { "mode": "off" }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [{ "color": "green", "value": null }]
          },
          "unit": "currencyUSD"
        },
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "actual_daily_cost" },
            "properties": [
              { "id": "displayName", "value": "Actual" },
              { "id": "color", "value": { "fixedColor": "red", "mode": "fixed" } }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "simulated_daily_cost" },
            "properties": [
              { "id": "displayName", "value": "Simulated" },
              { "id": "color", "value": { "fixedColor": "green", "mode": "fixed" } }
            ]
          }
        ]
      },
      "gridPos": { "h": 10, "w": 24, "x": 0, "y": 18 },
      "id": 6,
      "options": {
        "legend": {
          "calcs": ["sum", "mean"],
          "displayMode": "table",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "multi",
          "sort": "desc"
        }
      },
      "pluginVersion": "12.4.0",
      "targets": [{
        "datasource": {
          "type": "grafana-clickhouse-datasource",
          "uid": "PAD1A0A25CD30D456"
        },
        "format": 0,
        "range": true,
        "rawSql": "WITH user_day AS (\n  SELECT\n    toDate(start_time) AS day,\n    user_github_username AS user,\n    user_tier AS tier,\n    SUM(total_price) AS actual_spend\n  FROM generation_event\n  WHERE start_time >= $__fromTime AND start_time < $__toTime\n    AND selected_meter_slug = 'v1:meter:tier'\n    AND is_billed_usage = true\n    AND response_status >= 200 AND response_status < 300\n    AND user_tier IN ('microbe', 'spore', 'seed', 'flower', 'nectar')\n  GROUP BY day, user, tier\n)\nSELECT\n  day AS time,\n  round(SUM(actual_spend), 2) AS actual_daily_cost,\n  round(SUM(LEAST(actual_spend,\n    CASE tier\n      WHEN 'microbe' THEN ${sim_microbe}\n      WHEN 'spore'   THEN ${sim_spore}\n      WHEN 'seed'    THEN ${sim_seed}\n      WHEN 'flower'  THEN ${sim_flower}\n      WHEN 'nectar'  THEN ${sim_nectar}\n      ELSE 0\n    END\n  )), 2) AS simulated_daily_cost\nFROM user_day\nGROUP BY day\nORDER BY day",
        "refId": "A"
      }],
      "title": "Actual vs Simulated Daily Cost",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 28 },
      "id": 400,
      "panels": [],
      "title": "Simulated Daily Cost by Tier",
      "type": "row"
    },
    {
      "datasource": {
        "type": "grafana-clickhouse-datasource",
        "uid": "PAD1A0A25CD30D456"
      },
      "description": "Simulated daily cost broken down by tier. Each bar segment shows how much each tier would cost under the simulated allowances.",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "Pollen ($)",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "bars",
            "fillOpacity": 80,
            "gradientMode": "none",
            "hideFrom": { "legend": false, "tooltip": false, "viz": false },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": { "type": "linear" },
            "showPoints": "never",
            "spanNulls": false,
            "stacking": { "group": "A", "mode": "normal" },
            "thresholdsStyle": { "mode": "off" }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [{ "color": "green", "value": null }]
          },
          "unit": "currencyUSD"
        },
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "microbe" },
            "properties": [
              { "id": "displayName", "value": "Microbe" },
              { "id": "color", "value": { "fixedColor": "light-green", "mode": "fixed" } }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "spore" },
            "properties": [
              { "id": "displayName", "value": "Spore" },
              { "id": "color", "value": { "fixedColor": "green", "mode": "fixed" } }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "seed" },
            "properties": [
              { "id": "displayName", "value": "Seed" },
              { "id": "color", "value": { "fixedColor": "blue", "mode": "fixed" } }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "flower" },
            "properties": [
              { "id": "displayName", "value": "Flower" },
              { "id": "color", "value": { "fixedColor": "orange", "mode": "fixed" } }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "nectar" },
            "properties": [
              { "id": "displayName", "value": "Nectar" },
              { "id": "color", "value": { "fixedColor": "purple", "mode": "fixed" } }
            ]
          }
        ]
      },
      "gridPos": { "h": 10, "w": 24, "x": 0, "y": 29 },
      "id": 7,
      "options": {
        "legend": {
          "calcs": ["sum", "mean"],
          "displayMode": "table",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "multi",
          "sort": "desc"
        }
      },
      "pluginVersion": "12.4.0",
      "targets": [{
        "datasource": {
          "type": "grafana-clickhouse-datasource",
          "uid": "PAD1A0A25CD30D456"
        },
        "format": 0,
        "range": true,
        "rawSql": "WITH user_day AS (\n  SELECT\n    toDate(start_time) AS day,\n    user_github_username AS user,\n    user_tier AS tier,\n    SUM(total_price) AS actual_spend\n  FROM generation_event\n  WHERE start_time >= $__fromTime AND start_time < $__toTime\n    AND selected_meter_slug = 'v1:meter:tier'\n    AND is_billed_usage = true\n    AND response_status >= 200 AND response_status < 300\n    AND user_tier IN ('microbe', 'spore', 'seed', 'flower', 'nectar')\n  GROUP BY day, user, tier\n)\nSELECT\n  day AS time,\n  round(sumIf(LEAST(actual_spend, ${sim_microbe}), tier = 'microbe'), 2) AS microbe,\n  round(sumIf(LEAST(actual_spend, ${sim_spore}), tier = 'spore'), 2) AS spore,\n  round(sumIf(LEAST(actual_spend, ${sim_seed}), tier = 'seed'), 2) AS seed,\n  round(sumIf(LEAST(actual_spend, ${sim_flower}), tier = 'flower'), 2) AS flower,\n  round(sumIf(LEAST(actual_spend, ${sim_nectar}), tier = 'nectar'), 2) AS nectar\nFROM user_day\nGROUP BY day\nORDER BY day",
        "refId": "A"
      }],
      "title": "Simulated Daily Cost by Tier",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 39 },
      "id": 500,
      "panels": [],
      "title": "User Impact",
      "type": "row"
    },
    {
      "datasource": {
        "type": "grafana-clickhouse-datasource",
        "uid": "PAD1A0A25CD30D456"
      },
      "description": "Number of users per day per tier whose actual spend exceeded the simulated cap. These are the users who would be affected by the tier change.",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "Users Capped",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "bars",
            "fillOpacity": 60,
            "gradientMode": "none",
            "hideFrom": { "legend": false, "tooltip": false, "viz": false },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": { "type": "linear" },
            "showPoints": "never",
            "spanNulls": false,
            "stacking": { "group": "A", "mode": "normal" },
            "thresholdsStyle": { "mode": "off" }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [{ "color": "green", "value": null }]
          },
          "unit": "short"
        },
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "microbe" },
            "properties": [
              { "id": "displayName", "value": "Microbe" },
              { "id": "color", "value": { "fixedColor": "light-green", "mode": "fixed" } }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "spore" },
            "properties": [
              { "id": "displayName", "value": "Spore" },
              { "id": "color", "value": { "fixedColor": "green", "mode": "fixed" } }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "seed" },
            "properties": [
              { "id": "displayName", "value": "Seed" },
              { "id": "color", "value": { "fixedColor": "blue", "mode": "fixed" } }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "flower" },
            "properties": [
              { "id": "displayName", "value": "Flower" },
              { "id": "color", "value": { "fixedColor": "orange", "mode": "fixed" } }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "nectar" },
            "properties": [
              { "id": "displayName", "value": "Nectar" },
              { "id": "color", "value": { "fixedColor": "purple", "mode": "fixed" } }
            ]
          }
        ]
      },
      "gridPos": { "h": 10, "w": 24, "x": 0, "y": 40 },
      "id": 8,
      "options": {
        "legend": {
          "calcs": ["sum", "mean"],
          "displayMode": "table",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "multi",
          "sort": "desc"
        }
      },
      "pluginVersion": "12.4.0",
      "targets": [{
        "datasource": {
          "type": "grafana-clickhouse-datasource",
          "uid": "PAD1A0A25CD30D456"
        },
        "format": 0,
        "range": true,
        "rawSql": "WITH user_day AS (\n  SELECT\n    toDate(start_time) AS day,\n    user_github_username AS user,\n    user_tier AS tier,\n    SUM(total_price) AS actual_spend\n  FROM generation_event\n  WHERE start_time >= $__fromTime AND start_time < $__toTime\n    AND selected_meter_slug = 'v1:meter:tier'\n    AND is_billed_usage = true\n    AND response_status >= 200 AND response_status < 300\n    AND user_tier IN ('microbe', 'spore', 'seed', 'flower', 'nectar')\n  GROUP BY day, user, tier\n)\nSELECT\n  day AS time,\n  countIf(tier = 'microbe' AND actual_spend > ${sim_microbe}) AS microbe,\n  countIf(tier = 'spore' AND actual_spend > ${sim_spore}) AS spore,\n  countIf(tier = 'seed' AND actual_spend > ${sim_seed}) AS seed,\n  countIf(tier = 'flower' AND actual_spend > ${sim_flower}) AS flower,\n  countIf(tier = 'nectar' AND actual_spend > ${sim_nectar}) AS nectar\nFROM user_day\nGROUP BY day\nORDER BY day",
        "refId": "A"
      }],
      "title": "Users Capped Per Day by Tier",
      "type": "timeseries"
    }
  ],
  "refresh": "",
  "schemaVersion": 40,
  "tags": ["economics", "tier", "simulation"],
  "templating": {
    "list": [
      {
        "current": { "selected": false, "text": "0.1", "value": "0.1" },
        "description": "Simulated daily allowance for Microbe tier (current: $0.10)",
        "label": "Microbe Cap",
        "name": "sim_microbe",
        "type": "textbox",
        "query": "0.1",
        "skipUrlSync": false
      },
      {
        "current": { "selected": false, "text": "1", "value": "1" },
        "description": "Simulated daily allowance for Spore tier (current: $1)",
        "label": "Spore Cap",
        "name": "sim_spore",
        "type": "textbox",
        "query": "1",
        "skipUrlSync": false
      },
      {
        "current": { "selected": false, "text": "3", "value": "3" },
        "description": "Simulated daily allowance for Seed tier (current: $3)",
        "label": "Seed Cap",
        "name": "sim_seed",
        "type": "textbox",
        "query": "3",
        "skipUrlSync": false
      },
      {
        "current": { "selected": false, "text": "10", "value": "10" },
        "description": "Simulated daily allowance for Flower tier (current: $10)",
        "label": "Flower Cap",
        "name": "sim_flower",
        "type": "textbox",
        "query": "10",
        "skipUrlSync": false
      },
      {
        "current": { "selected": false, "text": "20", "value": "20" },
        "description": "Simulated daily allowance for Nectar tier (current: $20)",
        "label": "Nectar Cap",
        "name": "sim_nectar",
        "type": "textbox",
        "query": "20",
        "skipUrlSync": false
      }
    ]
  },
  "time": {
    "from": "now-30d/d",
    "to": "now/d"
  },
  "timepicker": {},
  "timezone": "browser",
  "title": "Tier Cost Simulation",
  "uid": "tier-cost-simulation",
  "version": 1,
  "weekStart": ""
}