services:
  model-server:
    build: .
    runtime: nvidia
    volumes:
      - model_cache:/app/model_cache
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - CUDA_VISIBLE_DEVICES=0
    command: python api/model_server.py
    networks:
      - app-network

  z-image:
    build: .
    runtime: nvidia
    ports:
      - "9000:9000"
    volumes:
      - model_cache:/app/model_cache
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - CUDA_VISIBLE_DEVICES=0
    depends_on:
      - model-server
    command: python api/app.py
    networks:
      - app-network

volumes:
  model_cache:
    driver: local

networks:
  app-network:
    driver: bridge