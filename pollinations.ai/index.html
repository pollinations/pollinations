<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- Theme & Description -->
    <meta name="theme-color" content="#ff6b35" />
    <meta name="description" content="AI creation playground - Generate images, text & audio with open source models" />
    
    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png" />
    <link rel="apple-touch-icon" sizes="167x167" href="/apple-touch-icon-167x167.png" />
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json" />
    
    <!-- Open Graph / Social Media -->
    <meta property="og:title" content="pollinations.ai" />
    <meta property="og:description" content="AI creation playground - Generate images, text & audio with open source models" />
    <meta property="og:image" content="/og-image.png" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://pollinations.ai" />
    
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="pollinations.ai" />
    <meta name="twitter:description" content="AI creation playground - Generate images, text & audio with open source models" />
    <meta name="twitter:image" content="/og-image.png" />
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    
    <title>pollinations.ai</title>
    
    <!-- Cloudflare Turnstile - Managed mode bot protection -->
    <link rel="preconnect" href="https://challenges.cloudflare.com">
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
    <script>
      // Pollinations Turnstile integration - auto-injects X-Turnstile-Token header
      (function() {
        // Use test key for localhost, production key for deployed
        const SITEKEY = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
          ? '1x00000000000000000000AA'  // Test key - always passes
          : '0x4AAAAAACJSvY_Ve3iBZzQA'; // Production key
        let token = null;
        let widgetId = null;
        
        function initTurnstile() {
          if (!window.turnstile) {
            setTimeout(initTurnstile, 100);
            return;
          }
          
          const div = document.createElement('div');
          div.style.cssText = 'position:fixed;bottom:20px;right:20px;z-index:9999;';
          document.body.appendChild(div);
          
          widgetId = window.turnstile.render(div, {
            sitekey: SITEKEY,
            size: 'normal',
            callback: (tok) => {
              token = tok;
              console.log('ðŸ” Turnstile verified');
            },
            'expired-callback': () => {
              token = null;
              window.turnstile.reset(widgetId);
            },
            'timeout-callback': () => {
              token = null;
              window.turnstile.reset(widgetId);
            },
            'error-callback': (err) => {
              console.warn('Turnstile error:', err);
              token = null;
            }
          });
        }
        
        document.addEventListener('DOMContentLoaded', initTurnstile);
        
        // Intercept fetch to add token header for pollinations.ai API calls
        const originalFetch = window.fetch;
        window.fetch = async (url, opts = {}) => {
          const urlStr = String(url);
          if (token && (urlStr.includes('pollinations.ai') || urlStr.startsWith('/api'))) {
            opts.headers = opts.headers || {};
            if (opts.headers instanceof Headers) {
              opts.headers.set('X-Turnstile-Token', token);
            } else {
              opts.headers['X-Turnstile-Token'] = token;
            }
          }
          return originalFetch(url, opts);
        };
        
        // Expose for manual use
        window.pollinationsTurnstile = {
          getToken: () => token,
          isReady: () => !!token,
          reset: () => widgetId && window.turnstile.reset(widgetId)
        };
      })();
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
