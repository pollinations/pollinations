import { type LLMThemeResponse, processTheme } from "../style/theme-processor";

export const AHyperAbstractStormOfCuteBiologicalFormsInConstantTransformationSwirlingPastelVorticesFilledWithMutatingRoundCreaturesFractalPollenBurstsLiquidSoftShapesSplittingMergingBendingAndBloomingEverythingPulsesTwistsStretchesRicochetsGentlyAndCollidesInSurrealChoreographyColorsExplodeInShiftingGradientsOfNeonPastelElectricPeachCosmicLavenderHotMintPlasmaYellowPearlescentPinkCreaturesAreBarelyDefinableMorphingPuffSpheresWithEyesElasticPetalLimbsFuzzyOrbsThatRippleLikeJellyPollenThreadsThatBraidAndUnbraidInMidairMotionIsSlowButOverwhelminglyComplexSpiralsLoopsCascadesSoftEruptionsTheEntireSceneFeelsLikeAnOtherworldlyBiologicalRaveIntenseDreamyChildlikeChaoticAndImpossiblyCute3dDeepParallaxShimmeringParticlesInfiniteSeamlessLoopTheme: LLMThemeResponse =
    {
        "slots": {
            "slot_0": {
                "hex": "#FFFFFF",
                "ids": ["text.primary", "input.text"],
            },
            "slot_1": {
                "hex": "#E2D5F5",
                "ids": ["text.secondary"],
            },
            "slot_2": {
                "hex": "#2D1B4E",
                "ids": ["input.bg", "button.secondary.bg", "border.subtle"],
            },
            "slot_3": {
                "hex": "#4A306E",
                "ids": ["input.border", "border.main"],
            },
            "slot_4": {
                "hex": "#8E7DAB",
                "ids": ["input.placeholder"],
            },
            "slot_5": {
                "hex": "#2A2033",
                "ids": ["button.disabled.bg"],
            },
            "slot_6": {
                "hex": "#FF9EAA",
                "ids": [
                    "button.focus.ring",
                    "indicator.image",
                    "background.element1",
                ],
            },
            "slot_7": {
                "hex": "#A78BFA",
                "ids": ["indicator.text", "background.element2"],
            },
            "slot_8": {
                "hex": "#FFF689",
                "ids": ["border.highlight", "logo.main", "background.particle"],
            },
            "slot_9": {
                "hex": "#B3A1C9",
                "ids": ["text.tertiary"],
            },
            "slot_10": {
                "hex": "#9080A0",
                "ids": ["text.caption"],
            },
            "slot_11": {
                "hex": "#1A0B2E",
                "ids": ["text.inverse"],
            },
            "slot_12": {
                "hex": "#FF85A1",
                "ids": [
                    "text.brand",
                    "button.primary.bg",
                    "button.primary.border",
                    "border.brand",
                ],
            },
            "slot_13": {
                "hex": "#70FFC7",
                "ids": [
                    "text.highlight",
                    "button.secondary.border",
                    "indicator.audio",
                    "border.strong",
                    "logo.accent",
                ],
            },
            "slot_21": {
                "hex": "#FF6B35",
                "ids": ["indicator.video"],
            },
            "slot_14": {
                "hex": "#0F0518",
                "ids": ["surface.page", "background.base"],
            },
            "slot_15": {
                "hex": "#1F1135",
                "ids": ["surface.card", "border.faint"],
            },
            "slot_16": {
                "hex": "#150821",
                "ids": ["surface.base"],
            },
        },
        "borderRadius": {
            "radius.button": "24px",
            "radius.card": "20px",
        },
        "fonts": {
            "font.title": "Fredoka",
            "font.headline": "Nunito",
            "font.body": "Quicksand",
        },
        "opacity": {
            "opacity.card": "0.85",
            "opacity.overlay": "0.9",
            "opacity.glass": "0.7",
        },
    };

export const AHyperAbstractStormOfCuteBiologicalFormsInConstantTransformationSwirlingPastelVorticesFilledWithMutatingRoundCreaturesFractalPollenBurstsLiquidSoftShapesSplittingMergingBendingAndBloomingEverythingPulsesTwistsStretchesRicochetsGentlyAndCollidesInSurrealChoreographyColorsExplodeInShiftingGradientsOfNeonPastelElectricPeachCosmicLavenderHotMintPlasmaYellowPearlescentPinkCreaturesAreBarelyDefinableMorphingPuffSpheresWithEyesElasticPetalLimbsFuzzyOrbsThatRippleLikeJellyPollenThreadsThatBraidAndUnbraidInMidairMotionIsSlowButOverwhelminglyComplexSpiralsLoopsCascadesSoftEruptionsTheEntireSceneFeelsLikeAnOtherworldlyBiologicalRaveIntenseDreamyChildlikeChaoticAndImpossiblyCute3dDeepParallaxShimmeringParticlesInfiniteSeamlessLoopCssVariables =
    processTheme(
        AHyperAbstractStormOfCuteBiologicalFormsInConstantTransformationSwirlingPastelVorticesFilledWithMutatingRoundCreaturesFractalPollenBurstsLiquidSoftShapesSplittingMergingBendingAndBloomingEverythingPulsesTwistsStretchesRicochetsGentlyAndCollidesInSurrealChoreographyColorsExplodeInShiftingGradientsOfNeonPastelElectricPeachCosmicLavenderHotMintPlasmaYellowPearlescentPinkCreaturesAreBarelyDefinableMorphingPuffSpheresWithEyesElasticPetalLimbsFuzzyOrbsThatRippleLikeJellyPollenThreadsThatBraidAndUnbraidInMidairMotionIsSlowButOverwhelminglyComplexSpiralsLoopsCascadesSoftEruptionsTheEntireSceneFeelsLikeAnOtherworldlyBiologicalRaveIntenseDreamyChildlikeChaoticAndImpossiblyCute3dDeepParallaxShimmeringParticlesInfiniteSeamlessLoopTheme,
    ).cssVariables;

// Background HTML (raw template literal)
export const AHyperAbstractStormOfCuteBiologicalFormsInConstantTransformationSwirlingPastelVorticesFilledWithMutatingRoundCreaturesFractalPollenBurstsLiquidSoftShapesSplittingMergingBendingAndBloomingEverythingPulsesTwistsStretchesRicochetsGentlyAndCollidesInSurrealChoreographyColorsExplodeInShiftingGradientsOfNeonPastelElectricPeachCosmicLavenderHotMintPlasmaYellowPearlescentPinkCreaturesAreBarelyDefinableMorphingPuffSpheresWithEyesElasticPetalLimbsFuzzyOrbsThatRippleLikeJellyPollenThreadsThatBraidAndUnbraidInMidairMotionIsSlowButOverwhelminglyComplexSpiralsLoopsCascadesSoftEruptionsTheEntireSceneFeelsLikeAnOtherworldlyBiologicalRaveIntenseDreamyChildlikeChaoticAndImpossiblyCute3dDeepParallaxShimmeringParticlesInfiniteSeamlessLoopBackgroundHtml = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Living Web - Biological Rave</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #000; /* Fallback */
        }
        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }
        #credit {
            position: absolute;
            bottom: 20px;
            right: 20px;
            font-family: sans-serif;
            color: rgba(255, 255, 255, 0.3);
            font-size: 10px;
            pointer-events: none;
            user-select: none;
            z-index: 10;
        }
    </style>
</head>
<body>
    <div id="credit">pollinations.ai background</div>
    <script type="module">
        import * as THREE from 'https://esm.sh/three';

        // Configuration & Color Tokens
        const COLORS = {
            background: '{{BACKGROUND_BASE}}',
            body: '{{BACKGROUND_ELEMENT1}}',
            details: '{{BACKGROUND_ELEMENT2}}',
            particles: '{{BACKGROUND_PARTICLE}}'
        };

        // State
        let scene, camera, renderer;
        let critters = [];
        let pollenSystem;
        let time = 0;
        
        // Reduced Motion Check
        const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

        // Geometry pools to reduce overhead
        const bodyGeo = new THREE.IcosahedronGeometry(1, 1);
        const detailGeo = new THREE.SphereGeometry(0.4, 8, 8);
        const ringGeo = new THREE.TorusGeometry(1.4, 0.1, 6, 20);

        function init() {
            // Scene Setup
            scene = new THREE.Scene();
            scene.background = new THREE.Color(COLORS.background);
            
            // Camera
            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 100);
            camera.position.z = 25;

            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: false });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2)); // Performance cap
            document.body.appendChild(renderer.domElement);

            // Materials (Basic Materials only per rules)
            const bodyMat = new THREE.MeshBasicMaterial({ 
                color: COLORS.body,
                transparent: true,
                opacity: 0.85,
                depthWrite: false
            });

            const detailMat = new THREE.MeshBasicMaterial({ 
                color: COLORS.details,
                transparent: true,
                opacity: 0.9,
                depthWrite: false
            });
            
            const ringMat = new THREE.MeshBasicMaterial({
                color: COLORS.details,
                transparent: true,
                opacity: 0.4,
                wireframe: true,
                depthWrite: false
            });

            // Create the "Critters" (Cute biological forms)
            const critterCount = 45; 
            
            for (let i = 0; i < critterCount; i++) {
                const group = new THREE.Group();
                
                // Initial positions in a spiral vortex
                const angle = i * 0.5;
                const radius = 4 + Math.random() * 10;
                const zPos = (i * 1.5) - (critterCount * 0.75);
                
                group.position.set(
                    Math.cos(angle) * radius,
                    Math.sin(angle) * radius,
                    zPos
                );
                
                // Store original pos for drift calculations
                group.userData = {
                    origin: group.position.clone(),
                    phase: Math.random() * Math.PI * 2,
                    speed: 0.5 + Math.random() * 0.5,
                    rotationSpeed: (Math.random() - 0.5) * 0.02,
                    type: Math.random() > 0.5 ? 'blob' : 'jelly'
                };

                // Main Body
                const body = new THREE.Mesh(bodyGeo, bodyMat);
                body.scale.setScalar(1 + Math.random());
                group.add(body);

                // Add Details (Eyes/Spores/Rings)
                if (group.userData.type === 'blob') {
                    // Floating satellites
                    const satCount = 2 + Math.floor(Math.random() * 3);
                    for (let j = 0; j < satCount; j++) {
                        const sat = new THREE.Mesh(detailGeo, detailMat);
                        // Place slightly outside body
                        sat.position.set(
                            (Math.random() - 0.5) * 2.5,
                            (Math.random() - 0.5) * 2.5,
                            (Math.random() - 0.5) * 2.5
                        );
                        sat.userData = { 
                            offset: Math.random() * 10,
                            orbitRadius: 1.5 + Math.random()
                        };
                        group.add(sat);
                    }
                } else {
                    // Jelly Ring
                    const ring = new THREE.Mesh(ringGeo, ringMat);
                    ring.rotation.x = Math.random() * Math.PI;
                    group.add(ring);
                }

                scene.add(group);
                critters.push(group);
            }

            // Create Pollen Storm (Particles)
            const particleCount = 600;
            const particlesGeo = new THREE.BufferGeometry();
            const posArray = new Float32Array(particleCount * 3);
            const randomArray = new Float32Array(particleCount); // For individual motion variation

            for(let i = 0; i < particleCount * 3; i+=3) {
                // Spread in a large volume
                posArray[i] = (Math.random() - 0.5) * 60;     // x
                posArray[i+1] = (Math.random() - 0.5) * 60;   // y
                posArray[i+2] = (Math.random() - 0.5) * 50;   // z
                
                randomArray[i/3] = Math.random();
            }

            particlesGeo.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
            particlesGeo.setAttribute('aRandom', new THREE.BufferAttribute(randomArray, 1));

            const particleMat = new THREE.PointsMaterial({
                color: COLORS.particles,
                size: 0.3,
                transparent: true,
                opacity: 0.6,
                sizeAttenuation: true,
                depthWrite: false
            });

            pollenSystem = new THREE.Points(particlesGeo, particleMat);
            scene.add(pollenSystem);

            // Event Listeners
            window.addEventListener('resize', onWindowResize, false);
            
            // Start loop
            animate();
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);

            if (prefersReducedMotion) {
                renderer.render(scene, camera);
                return;
            }

            // Update global time
            const now = performance.now() * 0.001;
            const dt = now - time;
            time = now;

            // 1. Animate Critters (The Cute Rave)
            critters.forEach((group, i) => {
                const u = group.userData;
                
                // "Breathing" / Morphing Scale
                // Sine wave based scale to look like soft jelly pulsing
                const pulse = Math.sin(time * 2 + u.phase) * 0.1 + 1;
                const stretch = Math.cos(time * 3 + u.phase) * 0.1 + 1;
                
                // The main body is always the first child
                const body = group.children[0];
                body.scale.set(pulse, stretch, pulse);
                
                // Orbital movement (Drift)
                // Move relative to origin to avoid drift issues
                const driftX = Math.sin(time * u.speed + u.phase) * 2;
                const driftY = Math.cos(time * (u.speed * 0.8) + u.phase) * 2;
                
                group.position.x = u.origin.x + driftX;
                group.position.y = u.origin.y + driftY;

                // Gentle rotation of the whole critter
                group.rotation.x += u.rotationSpeed;
                group.rotation.y += u.rotationSpeed * 1.5;

                // Animate Sub-elements (Eyes/Rings)
                for(let c = 1; c < group.children.length; c++) {
                    const child = group.children[c];
                    if (u.type === 'blob') {
                        // Orbiting satellites
                        const subTime = time * 1.5 + child.userData.offset;
                        child.position.x = Math.sin(subTime) * child.userData.orbitRadius;
                        child.position.z = Math.cos(subTime) * child.userData.orbitRadius;
                        child.position.y = Math.sin(subTime * 0.5) * 0.5;
                    } else {
                        // Wobbling rings
                        child.rotation.x = Math.sin(time + u.phase) * 0.2;
                        child.rotation.y = time * 0.2;
                    }
                }
            });

            // 2. Animate Pollen (Swirling Vortex)
            if (pollenSystem) {
                const positions = pollenSystem.geometry.attributes.position.array;
                const randoms = pollenSystem.geometry.attributes.aRandom.array;

                for(let i = 0; i < positions.length; i+=3) {
                    // Rotate around Z axis for vortex effect
                    const x = positions[i];
                    const y = positions[i+1];
                    const idx = i/3;
                    
                    const speed = 0.002 + (randoms[idx] * 0.002);
                    
                    // Simple 2D rotation matrix
                    const cosT = Math.cos(speed);
                    const sinT = Math.sin(speed);
                    
                    positions[i] = x * cosT - y * sinT;
                    positions[i+1] = x * sinT + y * cosT;
                    
                    // Gentle sway in Z
                    positions[i+2] += Math.sin(time + randoms[idx] * 10) * 0.02;
                }
                pollenSystem.geometry.attributes.position.needsUpdate = true;
                
                // Slowly rotate entire system
                pollenSystem.rotation.z = time * 0.05;
            }

            // 3. Camera Motion (Floating Observer)
            // Drifts slightly to create deep parallax feel
            camera.position.x = Math.sin(time * 0.2) * 2;
            camera.position.y = Math.cos(time * 0.3) * 2;
            camera.lookAt(0, 0, 0);

            renderer.render(scene, camera);
        }

        // Ignite
        init();

    </script>
</body>
</html>`;
