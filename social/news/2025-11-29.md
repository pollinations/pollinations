# Weekly Update - 2025-11-29

- **Fix Zod Deduplication in CI** — Added `resolve.dedupe: ["zod"]` to `vite.config.ts` to resolve CI build failures when importing from `shared/registry/model-info.ts`. [PR #5476](https://github.com/pollinations/pollinations/pull/5476)
- **Simplify Event Buffering & Balance Tracking** — Reverted complex local balance tracking in favor of a simpler approach that clears successfully sent events from the D1 buffer after one day. Improved batching to send if minimum pending events exist or events are older than 30 seconds. [PR #5473](https://github.com/pollinations/pollinations/pull/5473)
- **Add PolliPalmTop Project** — Added PolliPalmTop Android app to the Chat category. Features AI chat, web search, and image generation. [PR #5471](https://github.com/pollinations/pollinations/pull/5471)
- **Refactor Model Aliases** — Refactored model aliases into a separate file, simplified type definitions, and enforced consistent casing. [PR #5375](https://github.com/pollinations/pollinations/pull/5375)
- **Cache Invalidation Endpoint** — Added `DELETE /delete/prompt/:prompt` endpoint to remove cached images from both the R2 bucket and Vectorize index. Returns JSON status. [PR #5463](https://github.com/pollinations/pollinations/pull/5463)
- **Error Status Propagation & Azure Tokens** — Fixed streaming errors incorrectly returning HTTP 500 by propagating upstream status codes (e.g., 400, 401). Converted `max_tokens` to `max_completion_tokens` for Azure OpenAI models. [PR #5460](https://github.com/pollinations/pollinations/pull/5460)
- **4K Support for Nano Banana Pro** — Enabled 4K resolution support for `nanobanana-pro` by adding `imageConfig` with `aspectRatio` and `imageSize` to Vertex AI API calls. Auto-detects size based on requested pixel count. [PR #5454](https://github.com/pollinations/pollinations/pull/5454)
- **Relax OpenAI Schema Validation** — Updated schema to allow array content for system, developer, assistant, and tool messages. Added `cache_control` support for Anthropic and file content types for uploads. [PR #5456](https://github.com/pollinations/pollinations/pull/5456)
- **Local Balance Tracking** — Implemented local balance tracking using KV with a 5-minute TTL to reduce Polar API rate limits. Syncs with Polar only on cache miss or when balance is ≤ 0.1. [PR #5453](https://github.com/pollinations/pollinations/pull/5453)
- **Add Nano Banana Pro Model** — Added `nanobanana-pro` model using `gemini-3-pro-image-preview`. Supports 4K resolution and built-in "Thinking" process via configurable Vertex AI model ID. [PR #5427](https://github.com/pollinations/pollinations/pull/5427)
- **Remove Unused BPAIGen Fallback** — Removed dead code including `bpaigenModel.ts` and `kontextModel.ts` as the legacy API fallback is no longer reachable. [PR #5444](https://github.com/pollinations/pollinations/pull/5444)
- **Add Claude Opus 4.5 & Bedrock Defaults** — Added `claude-xlarge` (Claude Opus 4.5) and implemented a `defaultOptions` mechanism. Set default `max_tokens` to 16384 for Bedrock Lambda/Fargate models. [PR #5426](https://github.com/pollinations/pollinations/pull/5426)
- **Fix Image Service Health Check** — Updated deployment health check to use the `/about` endpoint instead of the deprecated `/models` endpoint (which returned HTTP 410). [PR #5447](https://github.com/pollinations/pollinations/pull/5447)
- **Fix Wrangler Deployment** — Removed the `--env production` flag from deployment scripts to resolve conflicts with Vite's `CLOUDFLARE_ENV` configuration in Wrangler 4.50+. [PR #5446](https://github.com/pollinations/pollinations/pull/5446)
- **Portkey Gateway Deployment Automation** — Added scripts and GitHub Actions to automate Portkey API gateway deployment to Cloudflare, pinned to commit `9d9a37a`. [PR #5442](https://github.com/pollinations/pollinations/pull/5442)
- **Relax Schema for Multi-Provider Compatibility** — Updated schema validation to accept string values for `finish_reason` and nullish `message.content` to support non-OpenAI providers like Gemini. [PR #5439](https://github.com/pollinations/pollinations/pull/5439)
- **Fix Secret Decryption** — Resolved oversights in the secret decryption logic. [PR #5436](https://github.com/pollinations/pollinations/pull/5436)
- **Organize Secrets** — Migrated encrypted secrets to JSON format stored in `**/secrets/*.json` and updated npm scripts and GitHub Actions to match the new location. [PR #5433](https://github.com/pollinations/pollinations/pull/5433)
- **Community Project Submissions** — Added SRT Translator CLI, VisionText VS Code Extension, and TeleChars AI to the project showcase. [PR #5432](https://github.com/pollinations/pollinations/pull/5432)
- **Pass-through OpenAI Parameters** — Enabled pass-through for `max_tokens`, `stop`, `max_completion_tokens`, `stream_options`, `logprobs`, and `logit_bias`. Upgraded Claude code action to Opus 4.5. [PR #5416](https://github.com/pollinations/pollinations/pull/5416)
- **Vertex AI Image URL Support** — Implemented a transform to convert HTTP image URLs to base64 data URLs for `vertex-ai` provider models to resolve MIME type errors. [PR #5415](https://github.com/pollinations/pollinations/pull/5415)
- **Simplify Flux Schnell Deployment** — Streamlined deployment with a single `setup.sh` and optimized `Dockerfile` for RTX 4090 (CUDA 12.8). Removed obsolete deployment scripts. [PR #5412](https://github.com/pollinations/pollinations/pull/5412)
- **Improve Integration Tests & Error Handling** — Enhanced integration tests and improved error handling logic when tracking streaming responses. [PR #5379](https://github.com/pollinations/pollinations/pull/5379)
